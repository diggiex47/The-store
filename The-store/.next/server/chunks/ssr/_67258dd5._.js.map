{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///home/milo/Project/Design/The-store/src/app/chat-test/page.tsx"],"sourcesContent":["// Location: app/chat-test/page.tsx\n\n\"use client\";\n\nimport { useSession } from \"next-auth/react\";\nimport { useEffect, useState } from \"react\";\n\n// Define a type for our structured chat messages\ninterface ChatMessage {\n  username: string;\n  content: string;\n}\n\nexport default function ChatTestPage() {\n  const { data: session, status } = useSession();\n  const [socket, setSocket] = useState<WebSocket | null>(null);\n  const [messages, setMessages] = useState<ChatMessage[]>([]);\n  const [input, setInput] = useState(\"\");\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    // This function sets up the WebSocket connection.\n    const connectToChat = async () => {\n      if (status === \"authenticated\") {\n        try {\n          const wsUrl = `ws://localhost:8000/?token=${session.apiToken}`;\n          const ws = new WebSocket(wsUrl);\n\n          // 3. Define what happens on different WebSocket events.\n          ws.onopen = () => {\n            console.log(\"WebSocket connection established\");\n            setMessages([{ username: \"System\", content: \"Connected!\" }]);\n            setError(null);\n          };\n\n          ws.onmessage = (event) => {\n            try {\n              // Parse the incoming JSON string into a ChatMessage object.\n              const messageData: ChatMessage = JSON.parse(event.data);\n              setMessages((prev) => [...prev, messageData]);\n            } catch (e) {\n              console.error(\"Failed to parse message JSON:\", e);\n            }\n          };\n\n          ws.onclose = () => {\n            console.log(\"WebSocket connection closed\");\n            setMessages((prev) => [\n              ...prev,\n              { username: \"System\", content: \"Disconnected!\" },\n            ]);\n          };\n\n          ws.onerror = (event) => {\n            console.error(\"WebSocket error: \", event);\n            setError(\"Connection failed.Check console for details.\");\n          };\n\n          setSocket(ws);\n          return () => ws.close();\n        } catch (err) {\n          console.error(\"Connection setup error:\", err);\n          setError((err as Error).message);\n        }\n      }\n    };\n\n    connectToChat();\n\n    // Cleanup function to close the connection when the page is left.\n    return () => {\n      if (socket) {\n        socket.close();\n      }\n    };\n  }, [status, session?.apiToken]);\n\n  // Function to send a message to the server.\n  const sendMessage = () => {\n    if (!socket || socket.readyState !== WebSocket.OPEN) {\n      setError(\"Not connected. Cannot send message.\");\n      return;\n    }\n    if (!input.trim()) return;\n\n    socket.send(\n      JSON.stringify({ username: session?.user?.name, content: input }),\n    );\n    setMessages((prev) => [\n      ...prev,\n      { username: session?.user?.name!, content: input },\n    ]);\n    setInput(\"\");\n  };\n\n  if (status === \"loading\") {\n    return <p className=\"p-8 text-center\">Authenticating...</p>;\n  }\n\n  if (status === \"unauthenticated\") {\n    return (\n      <p className=\"p-8 text-center text-red-600\">\n        Access Denied. Please log in to use the chat.\n      </p>\n    );\n  }\n\n  return (\n    <div className=\"mx-auto max-w-2xl p-8\">\n      <h1 className=\"mb-4 text-2xl font-bold\">WebSocket Chat Test</h1>\n      <div className=\"mb-4 h-80 overflow-y-scroll rounded-md border bg-gray-50 p-4\">\n        {/* Render the list of messages */}\n        {messages.map((msg, index) => (\n          <p key={index} className=\"mb-1 font-mono text-sm\">\n            <strong\n              className={\n                msg.username === \"System\" ? \"text-gray-500\" : \"text-blue-600\"\n              }\n            >\n              {msg.username}:\n            </strong>{\" \"}\n            {msg.content}\n          </p>\n        ))}\n      </div>\n\n      {error && <p className=\"mb-2 text-center text-red-600\">{error}</p>}\n\n      <div className=\"flex gap-2\">\n        <input\n          type=\"text\"\n          value={input}\n          onChange={(e) => setInput(e.target.value)}\n          onKeyDown={(e) => e.key === \"Enter\" && sendMessage()}\n          className=\"flex-grow rounded-md border p-2\"\n          placeholder=\"Type a message...\"\n        />\n        <button\n          onClick={sendMessage}\n          className=\"rounded-md bg-blue-500 p-2 text-white hover:bg-blue-600 disabled:bg-blue-300\"\n          disabled={!socket || socket.readyState !== WebSocket.OPEN}\n        >\n          Send\n        </button>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 218, "column": 0}, "map": {"version":3,"sources":["file:///home/milo/Project/Design/The-store/node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-dev-runtime.ts"],"sourcesContent":["module.exports = require('../../module.compiled').vendored[\n  'react-ssr'\n].ReactJsxDevRuntime\n"],"names":["module","exports","require","vendored","ReactJsxDevRuntime"],"mappings":";AAAAA,OAAOC,OAAO,GAAGC,QAAQ,4HAAyBC,QAAQ,CACxD,YACD,CAACC,kBAAkB","ignoreList":[0],"debugId":null}}]
}
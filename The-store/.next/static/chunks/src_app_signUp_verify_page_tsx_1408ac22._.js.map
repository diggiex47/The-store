{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///home/milo/Project/The-store/src/app/signUp/verify/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { useRouter, useSearchParams } from \"next/navigation\";\n\nexport default function VerificationPage() {\n  const [otp, setOtp] = useState(\"\");\n  const [error, setError] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n  const [status, setStatus] = useState(\"\");\n  const router = useRouter();\n  const searchParms = useSearchParams();\n  const email = searchParms.get(\"email\");\n  const [message, setMessage] = useState(\"\"); // For success messages\n  // --- NEW STATE FOR THE TIMER ---\n  const [countdown, setCountdown] = useState(60); // Start countdown from 60 seconds\n  const [isResending, setIsResending] = useState(false);\n\n  const searchParams = useSearchParams();\n\n  // --- NEW EFFECT FOR THE COUNTDOWN TIMER ---\n  useEffect(() => {\n    // If the countdown is active, set up an interval\n    if (countdown > 0) {\n      const timerId = setInterval(() => {\n        setCountdown((prevCountdown) => prevCountdown - 1);\n      }, 1000);\n\n      // Clean up the interval when the component unmounts or countdown finishes\n      return () => clearInterval(timerId);\n    }\n  }, [countdown]);\n\n  // --- NEW FUNCTION TO HANDLE RESENDING THE OTP ---\n  const handleResendOtp = async () => {\n    setIsResending(true);\n    setError(\"\");\n    setMessage(\"\");\n\n    try {\n      // We call the register endpoint again. It's designed to handle this.\n      // We pass dummy values for name/password as they are required by the API\n      // but not used when an unverified user already exists.\n      const res = await fetch(\"/api/register\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ email, name: \"resend\", password: \"resend\" }),\n      });\n\n      const data = await res.json();\n      if (!res.ok) {\n        throw new Error(data.error || \"Failed to resend OTP.\");\n      }\n\n      setMessage(\"A new OTP has been sent to your email.\");\n      setCountdown(60); // Reset the timer\n    } catch (err: any) {\n      setError(err.message);\n    } finally {\n      setIsResending(false);\n    }\n  };\n\n  // verify the otp\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n    setError(\"\");\n\n    try {\n      const res = await fetch(\"/api/verify\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ email, otp }),\n      });\n\n      if (res.ok) {\n        router.push(\"/signIn\");\n      } else {\n        const data = await res.json();\n        setError(data.message || \"OTP verification failed\");\n      }\n    } catch {\n      console.log(\"verification failed \", error);\n      setError(\"Something Went Wrong\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"mx-auto max-w-md p-4\">\n      <h2 className=\"mb-4 text-xl font-bold\">Verify Your Email</h2>\n      <p className=\"mb-4\">OTP sent to: {email}</p>\n\n      <form onSubmit={handleSubmit}>\n        <input\n          type=\"text\"\n          value={otp}\n          onChange={(e) => setOtp(e.target.value)}\n          placeholder=\"Enter 6-digit OTP\"\n          className=\"input input-bordered mb-3 w-full\"\n        />\n        {error && <p className=\"text-red-600\">{error}</p>}\n        <button className=\"btn btn-primary w-full\" disabled={loading}>\n          {loading ? \"Verifying...\" : \"Verify\"}\n        </button>\n\n        <div className=\"mt-4 text-center\">\n          <button\n            onClick={handleResendOtp}\n            disabled={countdown > 0 || isResending}\n            className=\"btn btn-link\" // Using a link-style button\n          >\n            {isResending\n              ? \"Sending...\"\n              : countdown > 0\n                ? `Resend OTP in ${countdown}s`\n                : \"Didn't receive code? Resend\"}\n          </button>\n        </div>\n      </form>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}